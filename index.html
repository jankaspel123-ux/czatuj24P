<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Czatuj24</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Share+Tech+Mono&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --lime:#39ff14;
  --bg-dark:#000;
  --bg-light:#fff;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Roboto Mono',monospace;
  background:var(--bg-dark);
  color:var(--lime);
  height:100vh;
  display:flex;
  flex-direction:column;
  background-size:cover;
  background-position:center;
  transition:background .2s,color .2s;
  overflow:hidden;
}
body.light{
  background:var(--bg-light);
  color:#000;
}
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  border-bottom:1px solid rgba(57,255,20,.15);
  background:rgba(0,0,0,.6);
}
body.light header{
  background:rgba(255,255,255,.9);
}
.logo{
  font-family:'Press Start 2P',monospace;
  font-weight:700;
  font-size:1.6rem;
  color:var(--lime);
  text-shadow:0 0 12px rgba(57,255,20,.45);
  animation:glow 2s infinite alternate;
}
@keyframes glow{
  0%{text-shadow:0 0 6px rgba(57,255,20,.25);}
  50%{text-shadow:0 0 18px rgba(57,255,20,.55);}
  100%{text-shadow:0 0 6px rgba(57,255,20,.25);}
}
.header-center{
  display:flex;
  align-items:center;
  gap:12px;
}
.online-indicator{
  font-family:'Press Start 2P',monospace;
  font-size:0.85rem;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid rgba(57,255,20,.18);
  background:rgba(0,0,0,.2);
  animation:blinkOnline 2s infinite alternate;
}
@keyframes blinkOnline{
  0%{opacity:0.8;}
  50%{opacity:1;}
  100%{opacity:0.8;}
}
.small-status{
  font-family:'Share Tech Mono',monospace;
  font-size:12px;
  opacity:.95;
}
.main{flex:1;display:flex;gap:12px;padding:12px;overflow:hidden;}
.chat{flex:1;display:flex;flex-direction:column;border-radius:8px;overflow:hidden;}
.messages{flex:1;padding:12px;display:flex;flex-direction:column;gap:8px;overflow:auto;background:rgba(0,0,0,.45);border-radius:8px;}
body.light .messages{background:rgba(255,255,255,.75);}
.msg{display:flex;align-items:flex-start;gap:8px;max-width:75%;animation:msgIn .18s ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(57,255,20,.18);}
.bubble{padding:8px 12px;border-radius:12px;background:#111;border:1px solid rgba(57,255,20,.06);color:var(--lime);}
.self .bubble{background:var(--lime);color:#000;}
.self{align-self:flex-end;flex-direction:row-reverse;}
.profile-panel{position:fixed;right:0;top:0;width:320px;height:100%;transform:translateX(100%);background:rgba(0,0,0,.95);padding:12px;display:flex;flex-direction:column;gap:8px;border-left:2px solid rgba(57,255,20,.12);transition:transform .22s;}
.profile-panel.open{transform:translateX(0);}
.profile-top{display:flex;justify-content:space-between;align-items:center;}
.profile-top h3{margin:0;font-family:'Share Tech Mono',monospace;color:var(--lime);}
.profile-actions button{background:transparent;border:1px dashed rgba(57,255,20,.14);color:var(--lime);padding:6px;border-radius:8px;cursor:pointer;}
.profile-panel label{font-weight:600;font-size:.9rem;}
.profile-panel input[type=text],.profile-panel input[type=number],.profile-panel select,.profile-panel textarea{
  padding:8px;border-radius:8px;border:1px solid rgba(57,255,20,.12);background:#0f0f0f;color:var(--lime);width:100%;}
body.light .profile-panel input,body.light .profile-panel select,body.light .profile-panel textarea{background:#fff;color:#000;}
.profile-avatar{width:90px;height:90px;border-radius:50%;object-fit:cover;box-shadow:0 0 12px rgba(57,255,20,.12);}
.panel-row{display:flex;gap:8px;}
.panel-row>div{flex:1;}
.controls{display:flex;align-items:center;gap:8px;padding:12px;border-top:1px solid rgba(57,255,20,.06);background:rgba(0,0,0,.6);}
body.light .controls{background:rgba(255,255,255,.9);}
.text-input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(57,255,20,.12);background:#0f0f0f;color:var(--lime);cursor:text;}
body.light .text-input{background:#fff;color:#000;}
.btn{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;font-family:'Press Start 2P',monospace;transition: all 0.2s ease;}
.btn:hover{transform:scale(1.05);box-shadow:0 0 8px var(--lime);}
.btn-start{background:var(--lime);color:#000;animation:btnGlow 1.5s infinite alternate;}
.btn-stop{background:transparent;color:var(--lime);border:1px solid rgba(57,255,20,.18);animation:btnGlow 1.5s infinite alternate;}
@keyframes btnGlow{
  0%{box-shadow:0 0 2px var(--lime);}
  50%{box-shadow:0 0 10px var(--lime);}
  100%{box-shadow:0 0 2px var(--lime);}
}
#toggleTheme,#muteToggle,#openProfile{
  font-family:'Share Tech Mono',monospace;
  font-size:1.1rem;
  background:transparent;
  border:none;
  color:var(--lime);
  margin-left:6px;
  cursor:pointer;
}
img.chat-img{max-width:120px;max-height:120px;border-radius:8px;cursor:pointer;transition:transform .2s;}
img.chat-img:hover{transform:scale(1.5);}
@media(max-width:760px){
  .profile-panel{width:92vw}
  .logo{font-size:1.4rem}
  .controls {flex-direction: column; gap: 6px;}
  .text-input, .btn {width: 100%; font-size:0.85rem; padding:8px;}
}
</style>
</head>
<body>

<header>
  <div class="logo">Czatuj24</div>
  <div class="header-center">
    <div class="online-indicator"><span id="onlineCount">Online: 0</span></div>
    <div class="small-status" id="statusInfo">Tw√≥j status: offline ‚Ä¢ Partner: brak</div>
  </div>
  <div>
    <button id="toggleTheme">üåô</button>
    <button id="muteToggle">üîä</button>
    <button id="openProfile">üßë‚Äçüíª Profil</button>
  </div>
</header>

<div class="main">
  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="controls">
      <input id="msgInput" class="text-input" placeholder="Napisz wiadomo≈õƒá..." />
      <button id="sendBtn" class="btn btn-start" disabled>Wy≈õlij</button>
      <button id="startBtn" class="btn btn-start">Start</button>
      <button id="stopBtn" class="btn btn-stop">Stop</button>
    </div>
  </div>
</div>

<!-- PANEL PROFILU BEZ ZMIAN -->
<aside class="profile-panel" id="profilePanel">
  <!-- ... tutaj reszta panelu jak w poprzednim kodzie ... -->
</aside>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

const toggleTheme=document.getElementById('toggleTheme');
const body=document.body;
toggleTheme.addEventListener('click',()=>{body.classList.toggle('light');});

const profilePanel=document.getElementById('profilePanel');
document.getElementById('openProfile').addEventListener('click',()=>{profilePanel.classList.add('open');});
document.getElementById('closeProfile').addEventListener('click',()=>{profilePanel.classList.remove('open');});
document.getElementById('hideProfile').addEventListener('click',()=>{profilePanel.classList.toggle('open');});

const ageSlider=document.getElementById('profileAge');
const ageValue=document.getElementById('ageValue');
ageSlider.addEventListener('input',()=>{ageValue.textContent=ageSlider.value;});
const bioTextarea=document.getElementById('profileBio');
const bioCount=document.getElementById('bioCount');
bioTextarea.addEventListener('input',()=>{bioCount.textContent=bioTextarea.value.length;});

const avatarInput=document.getElementById('avatarInput');
const avatarPreview=document.getElementById('avatarPreview');
avatarInput.addEventListener('change',e=>{const file=e.target.files[0];if(file){avatarPreview.src=URL.createObjectURL(file);}});

const bgInput=document.getElementById('bgInput');
let bgImage=null;
bgInput.addEventListener('change',e=>{const file=e.target.files[0];if(file){bgImage = URL.createObjectURL(file);body.style.backgroundImage = `url(${bgImage})`;body.style.backgroundSize = 'cover';body.style.backgroundPosition = 'center';}});

const messages=document.getElementById('messages');
const msgInput=document.getElementById('msgInput');
const sendBtn=document.getElementById('sendBtn');
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const muteToggle = document.getElementById('muteToggle');

let chatRunning=false;
let muted=false;
let photoTimer=null;

const soundSend = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
const soundReceive = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
const soundStart = new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg');
const soundStop = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');

muteToggle.addEventListener('click', ()=>{muted = !muted; muteToggle.textContent = muted ? "üîá" : "üîä";});
function playSound(sound){if(!muted) sound.play();}

// RESET PROFILU
document.getElementById('resetProfile').addEventListener('click', ()=>{ /* ... */ });

// START / STOP
startBtn.addEventListener('click', () => {
  playSound(soundStart);
  chatRunning = true;
  msgInput.disabled = false;
  sendBtn.disabled = true;
  messages.innerHTML='';
  addSystemMsg("≈ÅƒÖczenie z partnerem...");
  socket.emit('startChat');
  if(photoTimer) clearTimeout(photoTimer);
  photoTimer = setTimeout(()=>{sendBtn.disabled=false;},60000);
});
stopBtn.addEventListener('click', () => {
  if(!chatRunning) return;
  if(confirm("Czy na pewno zako≈Ñczyƒá rozmowƒô?")){
    chatRunning = false;
    msgInput.disabled = true;
    sendBtn.disabled = true;
    addSystemMsg("Czat zako≈Ñczony.");
    socket.emit('stopChat');
    playSound(soundStop);
  }
});

// WYSY≈ÅANIE WIADOMO≈öCI
sendBtn.addEventListener('click', sendMsg);
msgInput.addEventListener('click', ()=>{ /* klikalna rama */ });
msgInput.addEventListener('keypress', e=>{if(e.key==='Enter') sendMsg();});

function sendMsg(){
  if(!chatRunning) return; // wysy≈Ça tylko po starcie
  const text = msgInput.value.trim();
  if(!text) return;
  addMsg('self', text, avatarPreview.src);
  socket.emit('sendMessage', text);
  playSound(soundSend);
  msgInput.value='';
}

// FUNKCJE POMOCNICZE (dodawanie wiadomo≈õci / systemu / zdjƒôƒá)
function addMsg(cls,text,avatar){ /* ... */ }
function addPhotoMsg(cls,url,avatar){ /* ... */ }
function addSystemMsg(text){ /* ... */ }
</script>

</body>
</html>
