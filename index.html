<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Czatuj24</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Share+Tech+Mono&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
:root{
  --lime:#39ff14;
  --bg-dark:#000;
  --bg-light:#fff;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family:'Roboto Mono',monospace;
  background:var(--bg-dark);
  color:var(--lime);
  height:100vh;
  display:flex;
  flex-direction:column;
  background-size:cover;
  background-position:center;
  transition:background .2s,color .2s;
  overflow:hidden;
}
body.light{
  background:var(--bg-light);
  color:#000;
}
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  border-bottom:1px solid rgba(57,255,20,.15);
  background:rgba(0,0,0,.6);
}
body.light header{
  background:rgba(255,255,255,.9);
}
.logo{
  font-family:'Press Start 2P',monospace;
  font-weight:700;
  font-size:1.6rem;
  color:var(--lime);
  text-shadow:0 0 12px rgba(57,255,20,.45);
  animation:glow 2s infinite alternate;
}
@keyframes glow{
  0%{text-shadow:0 0 6px rgba(57,255,20,.25);}
  50%{text-shadow:0 0 18px rgba(57,255,20,.55);}
  100%{text-shadow:0 0 6px rgba(57,255,20,.25);}
}
.header-center{
  display:flex;
  align-items:center;
  gap:12px;
}
.online-indicator{
  font-family:'Share Tech Mono',monospace;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid rgba(57,255,20,.18);
  background:rgba(0,0,0,.2);
}
.small-status{
  font-family:'Press Start 2P',monospace;
  font-size:12px;
  opacity:.95;
}
.main{flex:1;display:flex;gap:12px;padding:12px;overflow:hidden;}
.chat{flex:1;display:flex;flex-direction:column;border-radius:8px;overflow:hidden;}
.messages{flex:1;padding:12px;display:flex;flex-direction:column;gap:8px;overflow:auto;background:rgba(0,0,0,.45);border-radius:8px;}
body.light .messages{background:rgba(255,255,255,.75);}
.msg{display:flex;align-items:flex-start;gap:8px;max-width:75%;animation:msgIn .18s ease;}
@keyframes msgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.msg .avatar{width:36px;height:36px;border-radius:50%;object-fit:cover;border:2px solid rgba(57,255,20,.18);}
.bubble{padding:8px 12px;border-radius:12px;background:#111;border:1px solid rgba(57,255,20,.06);color:var(--lime);}
.self .bubble{background:var(--lime);color:#000;}
.self{align-self:flex-end;flex-direction:row-reverse;}
.profile-panel{position:fixed;right:0;top:0;width:320px;height:100%;transform:translateX(100%);background:rgba(0,0,0,.95);padding:12px;display:flex;flex-direction:column;gap:8px;border-left:2px solid rgba(57,255,20,.12);transition:transform .22s;}
.profile-panel.open{transform:translateX(0);}
.profile-top{display:flex;justify-content:space-between;align-items:center;}
.profile-top h3{margin:0;font-family:'Share Tech Mono',monospace;color:var(--lime);}
.profile-actions button{background:transparent;border:1px dashed rgba(57,255,20,.14);color:var(--lime);padding:6px;border-radius:8px;cursor:pointer;}
.profile-panel label{font-weight:600;font-size:.9rem;}
.profile-panel input[type=text],.profile-panel input[type=number],.profile-panel select,.profile-panel textarea{
  padding:8px;border-radius:8px;border:1px solid rgba(57,255,20,.12);background:#0f0f0f;color:var(--lime);width:100%;}
body.light .profile-panel input,body.light .profile-panel select,body.light .profile-panel textarea{background:#fff;color:#000;}
.profile-avatar{width:90px;height:90px;border-radius:50%;object-fit:cover;box-shadow:0 0 12px rgba(57,255,20,.12);}
.panel-row{display:flex;gap:8px;}
.panel-row>div{flex:1;}
.controls{display:flex;align-items:center;gap:8px;padding:12px;border-top:1px solid rgba(57,255,20,.06);background:rgba(0,0,0,.6);}
body.light .controls{background:rgba(255,255,255,.9);}
.text-input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(57,255,20,.12);background:#0f0f0f;color:var(--lime);}
body.light .text-input{background:#fff;color:#000;}
.btn{padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;font-family:'Press Start 2P',monospace;}
.btn-start{background:var(--lime);color:#000;}
.btn-stop{background:transparent;color:var(--lime);border:1px solid rgba(57,255,20,.18);}
#toggleTheme,#muteToggle,#openProfile{
  font-family:'Share Tech Mono',monospace;
  font-size:1.1rem;
  background:transparent;
  border:none;
  color:var(--lime);
  margin-left:6px;
  cursor:pointer;
}
img.chat-img{max-width:120px;max-height:120px;border-radius:8px;cursor:pointer;transition:transform .2s;}
img.chat-img:hover{transform:scale(1.5);}
@media(max-width:760px){
  .profile-panel{width:92vw}
  .logo{font-size:1.25rem}
  .controls {flex-direction: column; gap: 6px;}
  .text-input, .btn {width: 100%;}
}
</style>
</head>
<body>

<header>
  <div class="logo">Czatuj24</div>
  <div class="header-center">
    <div class="online-indicator"><span id="onlineCount">Online: 0</span></div>
    <div class="small-status" id="statusInfo">Tw√≥j status: offline ‚Ä¢ Partner: brak</div>
  </div>
  <div>
    <button id="toggleTheme">üåô</button>
    <button id="muteToggle">üîä</button>
    <button id="openProfile">üßë‚Äçüíª Profil</button>
  </div>
</header>

<div class="main">
  <div class="chat">
    <div class="messages" id="messages"></div>
    <div class="controls">
      <input id="msgInput" class="text-input" placeholder="Napisz wiadomo≈õƒá..." disabled />
      <button id="sendBtn" class="btn btn-start" disabled>Wy≈õlij</button>
      <button id="startBtn" class="btn btn-start">Start</button>
      <button id="stopBtn" class="btn btn-stop">Stop</button>
    </div>
  </div>
</div>

<aside class="profile-panel" id="profilePanel">
  <div class="profile-top">
    <h3>Tw√≥j profil</h3>
    <div class="profile-actions">
      <button id="hideProfile" title="Schowaj">‚ãÆ</button>
      <button id="closeProfile" title="Zamknij">‚úñ</button>
    </div>
  </div>

  <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
    <img id="avatarPreview" class="profile-avatar" src="https://i.pravatar.cc/90" alt="avatar" />
    <input id="avatarInput" type="file" accept="image/*" />
    <input id="bgInput" type="file" accept="image/*" />
  </div>

  <label>Nick:</label>
  <input type="text" id="profileNick" maxlength="20" />

  <div class="panel-row">
    <div>
      <label>Ja jestem:</label>
      <select id="profileSex">
        <option value="kobieta">Kobieta</option>
        <option value="mezczyzna">Mƒô≈ºczyzna</option>
        <option value="bi">Bi</option>
      </select>
    </div>
    <div>
      <label>Kogo szukam:</label>
      <select id="profileTarget">
        <option value="kobieta">Kobieta</option>
        <option value="mezczyzna">Mƒô≈ºczyzna</option>
        <option value="bi">Bi</option>
      </select>
    </div>
  </div>

  <label>Cel czatu:</label>
  <select id="profilePurpose">
    <option value="randka">Randka</option>
    <option value="spotkanie">Spotkanie</option>
    <option value="seks">Seks</option>
    <option value="rozmowa">Rozmowa</option>
  </select>

  <label>Wiek: <span id="ageValue">25</span></label>
  <input type="range" id="profileAge" min="18" max="100" value="25" />

  <label>Biogram (max 200 znak√≥w):</label>
  <textarea id="profileBio" maxlength="200" placeholder="Kr√≥tki opis..."></textarea>
  <div style="text-align:right;font-size:11px;"><span id="bioCount">0</span>/200</div>

  <label>Status:</label>
  <select id="profileStatus">
    <option value="dostepny">Dostƒôpny</option>
    <option value="zaraz">Zaraz wracam</option>
  </select>

  <button id="resetProfile" class="btn btn-stop">Przywr√≥ƒá ustawienia</button>
</aside>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
const toggleTheme=document.getElementById('toggleTheme');
const body=document.body;
toggleTheme.addEventListener('click',()=>{body.classList.toggle('light');});
const profilePanel=document.getElementById('profilePanel');
document.getElementById('openProfile').addEventListener('click',()=>{profilePanel.classList.add('open');});
document.getElementById('closeProfile').addEventListener('click',()=>{profilePanel.classList.remove('open');});
document.getElementById('hideProfile').addEventListener('click',()=>{profilePanel.classList.toggle('open');});
const ageSlider=document.getElementById('profileAge');
const ageValue=document.getElementById('ageValue');
ageSlider.addEventListener('input',()=>{ageValue.textContent=ageSlider.value;});
const bioTextarea=document.getElementById('profileBio');
const bioCount=document.getElementById('bioCount');
bioTextarea.addEventListener('input',()=>{bioCount.textContent=bioTextarea.value.length;});
const avatarInput=document.getElementById('avatarInput');
const avatarPreview=document.getElementById('avatarPreview');
avatarInput.addEventListener('change',e=>{const file=e.target.files[0];if(file){avatarPreview.src=URL.createObjectURL(file);}});
const bgInput=document.getElementById('bgInput');
let bgImage=null;
bgInput.addEventListener('change',e=>{const file=e.target.files[0];if(file){bgImage = URL.createObjectURL(file);body.style.backgroundImage = `url(${bgImage})`;body.style.backgroundSize = 'cover';body.style.backgroundPosition = 'center';}});
const messages=document.getElementById('messages');
const msgInput=document.getElementById('msgInput');
const sendBtn=document.getElementById('sendBtn');
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const muteToggle = document.getElementById('muteToggle');
let chatRunning=false;
let muted=false;
let photoTimer=null;
const soundSend = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
const soundReceive = new Audio('https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg');
const soundStart = new Audio('https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg');
const soundStop = new Audio('https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg');
muteToggle.addEventListener('click', ()=>{muted = !muted; muteToggle.textContent = muted ? "üîá" : "üîä";});
function playSound(sound){if(!muted) sound.play();}
document.getElementById('resetProfile').addEventListener('click', ()=>{
  avatarPreview.src = "https://i.pravatar.cc/90";
  bgImage=null;
  body.style.backgroundImage = '';
  document.getElementById('profileNick').value='';
  document.getElementById('profileSex').value='kobieta';
  document.getElementById('profileTarget').value='kobieta';
  document.getElementById('profilePurpose').value='randka';
  document.getElementById('profileAge').value=25;
  ageValue.textContent=25;
  document.getElementById('profileBio').value='';
  bioCount.textContent=0;
  document.getElementById('profileStatus').value='dostepny';
});
startBtn.addEventListener('click', () => {
  playSound(soundStart);
  chatRunning = true;
  msgInput.disabled = false;
  sendBtn.disabled = true;
  messages.innerHTML='';
  addSystemMsg("≈ÅƒÖczenie z partnerem...");
  socket.emit('startChat');
  if(photoTimer) clearTimeout(photoTimer);
  photoTimer = setTimeout(()=>{sendBtn.disabled=false;},60000);
});
stopBtn.addEventListener('click', () => {
  if(!chatRunning) return;
  if(confirm("Czy na pewno zako≈Ñczyƒá rozmowƒô?")){
    chatRunning = false;
    msgInput.disabled = true;
    sendBtn.disabled = true;
    addSystemMsg("Czat zako≈Ñczony.");
    socket.emit('stopChat');
    playSound(soundStop);
  }
});
sendBtn.addEventListener('click', sendMsg);
msgInput.addEventListener('keypress', e=>{if(e.key==='Enter') sendMsg();});
function sendMsg(){
  const text = msgInput.value.trim();
  if(!text) return;
  addMsg('self', text, avatarPreview.src);
  socket.emit('sendMessage', text);
  playSound(soundSend);
  msgInput.value='';
}
socket.on('receiveMessage', msg => {
  if(msg.type==='text'){
    addMsg('partner', msg.content, 'https://i.pravatar.cc/90');
  }else if(msg.type==='photo'){
    addPhotoMsg('partner', msg.content, 'https://i.pravatar.cc/90');
  }
  playSound(soundReceive);
});
socket.on('partnerFound', () => {addSystemMsg("Partner po≈ÇƒÖczony. Mo≈ºesz pisaƒá!");});
socket.on('partnerStopped', () => {if(chatRunning){addSystemMsg("Partner zako≈Ñczy≈Ç rozmowƒô."); chatRunning=false; msgInput.disabled=true; sendBtn.disabled=true;}});
function addMsg(cls,text,avatar){
  const div=document.createElement('div');
  div.className='msg '+cls;
  const img=document.createElement('img');
  img.className='avatar';
  img.src=avatar;
  const bubble=document.createElement('div');
  bubble.className='bubble';
  bubble.textContent=text;
  div.appendChild(img);
  div.appendChild(bubble);
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}
function addPhotoMsg(cls,url,avatar){
  const div=document.createElement('div');
  div.className='msg '+cls;
  const imgAvatar=document.createElement('img');
  imgAvatar.className='avatar';
  imgAvatar.src=avatar;
  const photo=document.createElement('img');
  photo.className='chat-img';
  photo.src=url;
  photo.addEventListener('click',()=>{window.open(url,'_self');});
  div.appendChild(imgAvatar);
  div.appendChild(photo);
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}
function addSystemMsg(text){
  const div=document.createElement('div');
  div.className='msg';
  const bubble=document.createElement('div');
  bubble.className='bubble';
  bubble.style.background='transparent';
  bubble.style.border='1px dashed rgba(57,255,20,.25)';
  bubble.textContent=text;
  div.appendChild(bubble);
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
}
</script>

</body>
</html>
